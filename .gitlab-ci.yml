stages:
  - sync

sync_github:
  stage: sync
  variables:
    GITHUB_ORG: "kpihx-labs"
    REPO_NAME: "scripts"
  only:
    - main
  script:
    - echo "üîç V√©rification/Cr√©ation du repo sur GitHub..."
    - |
      curl -H "Authorization: token ${GITHUB_TOKEN}" \
           -X POST \
           -d "{\"name\":\"${REPO_NAME}\", \"private\":false}" \
           https://api.github.com/orgs/${GITHUB_ORG}/repos || true
    
    - echo "üîÑ Synchronisation..."
    # On s'assure que le remote est bien configur√©
    - git remote add github https://x-access-token:${GITHUB_TOKEN}@github.com/${GITHUB_ORG}/${REPO_NAME}.git || git remote set-url github https://x-access-token:${GITHUB_TOKEN}@github.com/${GITHUB_ORG}/${REPO_NAME}.git
    
    # Correction ici : on pousse explicitement le SHA actuel vers la branche main distante
    - git push github $CI_COMMIT_SHA:refs/heads/main --force
